From 0a648c9d2436ccfcf3c517015a410e5e33282588 Mon Sep 17 00:00:00 2001
From: Marko Lindqvist <cazfi74@gmail.com>
Date: Sun, 17 Sep 2023 12:53:20 +0300
Subject: [PATCH 30/30] Flatpak: Build with meson

See osdn #45871

Signed-off-by: Marko Lindqvist <cazfi74@gmail.com>
---
 platforms/flatpak/build_flatpak.sh        |  8 --------
 platforms/flatpak/org.freeciv.gtk322.yml  |  9 ++++-----
 platforms/flatpak/org.freeciv.gtk4.yml    |  9 ++++-----
 platforms/flatpak/org.freeciv.mp.gtk3.yml | 11 +++++------
 platforms/flatpak/org.freeciv.mp.gtk4.yml | 11 +++++------
 platforms/flatpak/org.freeciv.qt.yml      | 12 +++++-------
 platforms/flatpak/org.freeciv.ruledit.yml | 14 ++++++--------
 platforms/flatpak/org.freeciv.sdl2.yml    | 14 ++++----------
 8 files changed, 33 insertions(+), 55 deletions(-)

diff --git a/platforms/flatpak/build_flatpak.sh b/platforms/flatpak/build_flatpak.sh
index eb486a3c2e..ff88cddded 100755
--- a/platforms/flatpak/build_flatpak.sh
+++ b/platforms/flatpak/build_flatpak.sh
@@ -16,14 +16,6 @@ BROOT="$(pwd)"
 cd "$(dirname "$0")" || exit 1
 FCVER=$(../../fc_version)
 
-# On a git clone, regenerate configure with autogen.sh
-if test -f ../../.git && test -x ../../autogen.sh ; then
-  if ! ( cd ../.. && ./autogen.sh --no-configure-run ) ; then
-    echo "Autogen.sh FAILED" >&2
-    exit 1
-  fi
-fi
-
 if ! flatpak-builder --user --repo="${BROOT}/repo" --state-dir="${BROOT}/state" --force-clean "${BROOT}/build" org.freeciv.gtk4.yml ||
    ! flatpak-builder --user --repo="${BROOT}/repo" --state-dir="${BROOT}/state" --force-clean "${BROOT}/build" org.freeciv.gtk322.yml ||
    ! flatpak-builder --user --repo="${BROOT}/repo" --state-dir="${BROOT}/state" --force-clean "${BROOT}/build" org.freeciv.mp.gtk4.yml ||
diff --git a/platforms/flatpak/org.freeciv.gtk322.yml b/platforms/flatpak/org.freeciv.gtk322.yml
index 60d4023577..81dc93ec9b 100644
--- a/platforms/flatpak/org.freeciv.gtk322.yml
+++ b/platforms/flatpak/org.freeciv.gtk322.yml
@@ -13,13 +13,12 @@ finish-args:
   - --filesystem=~/.freeciv:create
 modules:
   - name: freeciv-gtk3.22
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --enable-client=gtk3.22
-      - --disable-fcmp
-      - --disable-freeciv-manual
+      - -Dclients=gtk3.22
+      - -Dfcmp=[]
+      - -Druledit=false
     sources:
       - type: dir
         path: ../..
diff --git a/platforms/flatpak/org.freeciv.gtk4.yml b/platforms/flatpak/org.freeciv.gtk4.yml
index 4588a59afc..9e736d74ca 100644
--- a/platforms/flatpak/org.freeciv.gtk4.yml
+++ b/platforms/flatpak/org.freeciv.gtk4.yml
@@ -13,13 +13,12 @@ finish-args:
   - --filesystem=~/.freeciv:create
 modules:
   - name: freeciv-gtk4
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --enable-client=gtk4
-      - --disable-fcmp
-      - --disable-freeciv-manual
+      - -Dclients=gtk4
+      - -Dfcmp=[]
+      - -Druledit=false
     sources:
       - type: dir
         path: ../..
diff --git a/platforms/flatpak/org.freeciv.mp.gtk3.yml b/platforms/flatpak/org.freeciv.mp.gtk3.yml
index efa8928b85..a38692d0e2 100644
--- a/platforms/flatpak/org.freeciv.mp.gtk3.yml
+++ b/platforms/flatpak/org.freeciv.mp.gtk3.yml
@@ -12,14 +12,13 @@ finish-args:
   - --filesystem=~/.freeciv:create
 modules:
   - name: freeciv-mp-gtk3
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --enable-fcmp=gtk3
-      - --disable-client
-      - --disable-server
-      - --disable-freeciv-manual
+      - -Dfcmp=gtk3
+      - -Dclients=[]
+      - -Dserver=disabled
+      - -Druledit=false
     sources:
       - type: dir
         path: ../..
diff --git a/platforms/flatpak/org.freeciv.mp.gtk4.yml b/platforms/flatpak/org.freeciv.mp.gtk4.yml
index ab52ca2851..caefc66df1 100644
--- a/platforms/flatpak/org.freeciv.mp.gtk4.yml
+++ b/platforms/flatpak/org.freeciv.mp.gtk4.yml
@@ -12,14 +12,13 @@ finish-args:
   - --filesystem=~/.freeciv:create
 modules:
   - name: freeciv-mp-gtk4
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --enable-fcmp=gtk4
-      - --disable-client
-      - --disable-server
-      - --disable-freeciv-manual
+      - -Dfcmp=gtk4
+      - -Dclients=[]
+      - -Dserver=disabled
+      - -Druledit=false
     sources:
       - type: dir
         path: ../..
diff --git a/platforms/flatpak/org.freeciv.qt.yml b/platforms/flatpak/org.freeciv.qt.yml
index 52bdfc33a6..f8939c65c2 100644
--- a/platforms/flatpak/org.freeciv.qt.yml
+++ b/platforms/flatpak/org.freeciv.qt.yml
@@ -13,15 +13,13 @@ finish-args:
   - --filesystem=~/.freeciv:create
 modules:
   - name: freeciv-qt
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --with-qtver=qt6
-      - --enable-client=qt
-      - --disable-fcmp
-      - --disable-ruledit
-      - --disable-freeciv-manual
+      - -Dqtver=qt6
+      - -Dclients=qt
+      - -Dfcmp=[]
+      - -Druledit=false
     sources:
       - type: dir
         path: ../..
diff --git a/platforms/flatpak/org.freeciv.ruledit.yml b/platforms/flatpak/org.freeciv.ruledit.yml
index ebcd5abb61..4605edcef9 100644
--- a/platforms/flatpak/org.freeciv.ruledit.yml
+++ b/platforms/flatpak/org.freeciv.ruledit.yml
@@ -11,16 +11,14 @@ finish-args:
   - --filesystem=~/.freeciv:create
 modules:
   - name: freeciv-ruledit
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --with-qtver=qt6
-      - --enable-ruledit
-      - --disable-client
-      - --disable-server
-      - --disable-fcmp
-      - --disable-freeciv-manual
+      - -Dqtver=qt6
+      - -Druledit=true
+      - -Dclients=[]
+      - -Dserver=disabled
+      - -Dfcmp=[]
     sources:
       - type: dir
         path: ../..
diff --git a/platforms/flatpak/org.freeciv.sdl2.yml b/platforms/flatpak/org.freeciv.sdl2.yml
index bda873b7d8..0b49e5fea6 100644
--- a/platforms/flatpak/org.freeciv.sdl2.yml
+++ b/platforms/flatpak/org.freeciv.sdl2.yml
@@ -13,19 +13,13 @@ finish-args:
   - --socket=pulseaudio
   - --filesystem=~/.freeciv:create
 modules:
-  - name: sdl2-gfx
-    sources:
-      - type: archive
-        url: https://www.ferzkopp.net/Software/SDL2_gfx/SDL2_gfx-1.0.4.tar.gz
-        sha256: 63e0e01addedc9df2f85b93a248f06e8a04affa014a835c2ea34bfe34e576262
   - name: freeciv-sdl2
-    buildsystem: autotools
+    buildsystem: meson
     no-autogen: true
-    builddir: true
     config-opts:
-      - --enable-client=sdl2
-      - --disable-fcmp
-      - --disable-freeciv-manual
+      - -Dclients=sdl2
+      - -Dfcmp=[]
+      - -Druledit=false
     sources:
       - type: dir
         path: ../..
-- 
2.40.1

